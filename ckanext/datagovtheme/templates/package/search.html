{% ckan_extends %}

{% block breadcrumb %}
{% endblock %}
{% block primary_content %}

<section class="module">
    <div class="new-results">
        {% snippet 'snippets/search_result_text.html', query=c.q, count=c.page.item_count, type='dataset' %}
        </div>
            <div class="module-content">
                {% if c.query_error %}
                {% trans %}
                <p><strong>There was an error while searching.</strong> Please try again.</p>
                {% endtrans %}
                {% endif %}
                {{ h.snippet('snippets/package_list.html', packages=c.page.items, show_organization=true) }}
            </div>

            {{ c.page.pager(q=c.q) }}

            <div style="text-align:center; margin-top:20px;">
                {% if c.page.item_count > 0 %}
                <b>
                    {% snippet 'snippets/search_result_text.html', query=c.q, count=c.page.item_count, type='dataset' %}
                </b>
                {% endif %}
                {% if c.q != '' and c.page.item_count > 0 %}
                <p class="extra"><b>You are searching in the list of datasets. Show results in <a href="//www.data.gov/search-results/?group=site&q={{c.q}}">entire Data.gov site</a>.</b></p>
                {% endif %}
            </div>

</section>

<section class="module">
    <div class="module-content">
        <p>
            <small>
                {% set api_link = h.link_to(_('API'), h.url_for(controller='api', action='get_api', ver=3)) %}
                {% set api_doc_link = h.link_to(_('API Docs'), 'http://docs.ckan.org/{0}/{1}/api/'.format(request.environ.CKAN_LANG, g.ckan_doc_version)) %}
                {% if g.dumps_url -%}
                {% set dump_link = h.link_to(_('full {format} dump').format(format=g.dumps_format), g.dumps_url) %}
                {% trans %}
                You can also access this registry using the {{ api_link }} (see {{ api_doc_link }}) or download a {{ dump_link }}.
                {% endtrans %}
                {% else %}
                {% trans %}
                You can also access this registry using the {{ api_link }} (see {{ api_doc_link}}).
                {% endtrans %}
                {%- endif %}
            </small>
        </p>
        <p>
            <small>
                Didn't find what you're looking for? Suggest a dataset <a href="http://data.gov/nominate">here</a>.
            </small>
        </p>
    </div>
</section>

{% endblock %}


{% block secondary_content %}
<section id="dataset-map" class="module module-narrow module-shallow">
    <h2 class="module-heading">
        <i class="icon-medium icon-globe"></i>
        {{ _('Filter by location') }}
        <a href="{{ h.remove_url_param(['ext_bbox','ext_prev_extent', 'ext_location']) }}" class="action">{{ _('Clear') }}</a>
    </h2>
    <div id="dataset-map-edit">
        <label for="field-location" class="hide">{{ _('Filter by location') }}</label>
        <input type="text" id="field-location" placeholder="{{ _('Enter location...') }}"
               value="{{ request.params.ext_location }}"
               data-module="location-autocomplete"
               data-module-source="/api/action/location_search" />
    </div>
    <div class="dataset-map" data-module="spatial-query">
        <div id="dataset-map-container"></div>
    </div>
    <div id="dataset-map-attribution">
        <div>Map data CC-BY-SA by <a href="http://openstreetmap.org">OpenStreetMap</a></div>
        <div>Tiles by <a href="http://www.mapquest.com">MapQuest</a></div>
    </div>
</section>

{% resource 'datagovtheme/spatial_query' %}

{{ super() }}

{% endblock %}

